name: CI

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  contracts:
    uses: SarradaHub/platform/.github/workflows/contracts.yaml@main
    with:
      working-directory: .
      install-command: bundle install
      test-command: bundle exec rspec spec/jobs/events/publish_payment_received_job_spec.rb
      schema-glob: platform/contracts/schemas/finance/payment.received.v1.json

  rails-ci:
    uses: SarradaHub/platform/.github/workflows/rails-service-ci.yaml@main
    with:
      working-directory: .
      ruby-version: '3.3.6'
      run-brakeman: true
      run-importmap-audit: true
      run-rubycritic: true
      postgres-db: pickup_game_manager_test
      rspec-command: bin/rails db:test:prepare && bundle exec rspec
      extra-apt-packages: "google-chrome-stable"
