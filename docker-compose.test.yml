# Test-specific docker-compose configuration
# This extends docker-compose.yml with test-optimized settings
# Usage: docker-compose -f docker-compose.yml -f docker-compose.test.yml [command]

services:
  db:
    environment:
      POSTGRES_DB: pickup_game_manager_test
    # Use separate volume for test data (overrides development volume)
    volumes:
      - pgdata_test:/var/lib/postgresql/data

  app:
    environment:
      RAILS_ENV: test
      RAILS_LOG_LEVEL: warn
      POSTGRES_DB: pickup_game_manager_test
      # Test environment optimizations
      RAILS_MAX_THREADS: 5
      WEB_CONCURRENCY: 1
      # Disable unnecessary features for tests
      RAILS_SERVE_STATIC_FILES: "false"
    # Don't expose ports for test environment (tests don't need web access)
    # Note: In docker-compose, omitting ports will not expose them
    ports: []
    # Remove interactive mode for tests (non-interactive)
    stdin_open: false
    tty: false
    # Override volumes for test environment
    volumes:
      # Mount source code for tests (same as dev, but with test env)
      - .:/rails:cached
      # Exclude directories that should be container-specific
      - /rails/tmp
      - /rails/log
      - /rails/node_modules
      - /rails/public/assets
      - /rails/public/packs
      # Bundle cache for faster gem installs (shared with dev)
      - bundle_cache:/usr/local/bundle
      # Test storage (separate from development to avoid conflicts)
      - rails_storage_test:/rails/storage

volumes:
  # Test-specific volumes (separate from development)
  pgdata_test:
  rails_storage_test:
