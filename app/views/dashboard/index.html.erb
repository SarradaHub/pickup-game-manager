<div class="grid grid-cols-1 md:grid-cols-12 gap-6">
  <!-- Header Section -->
  <header class="md:col-span-12">
    <h1 class="text-3xl font-bold mb-2 flex items-center gap-3">
      <span class="w-2 h-10 bg-gradient-to-b from-secondary-500 via-secondary-600 to-primary-600 rounded-full"></span>
      <span>Painel de Controle - Gerenciador de Jogos</span>
    </h1>
    <p class="text-sm text-neutral-600 ml-5">Gerencie seus jogos, atletas e finan√ßas</p>
  </header>

  <!-- Financial Overview Cards -->
  <section class="md:col-span-12">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
      <span class="w-1 h-6 bg-gradient-to-b from-success-500 to-success-600 rounded-full"></span>
      Vis√£o Geral Financeira
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <%= render 'dashboard/stat_card', icon: 'üí∞', title: 'Receita do M√™s', value: @monthly_summary[:income_value], currency: true, card_color: 'success' %>
      <%= render 'dashboard/stat_card', icon: 'üí∏', title: 'Despesas do M√™s', value: @monthly_summary[:expenses_value], currency: true, card_color: 'error' %>
      <%= render 'dashboard/stat_card', icon: 'üìà', title: 'Lucro do M√™s', value: @monthly_summary[:profit], value_color: @monthly_summary[:profit] >= 0 ? 'text-success-600' : 'text-error-600', currency: true, card_color: @monthly_summary[:profit] >= 0 ? 'success' : 'error' %>
      <%= render 'dashboard/stat_card', icon: 'üìä', title: 'Ano at√© Hoje', value: @yearly_summary[:profit], value_color: @yearly_summary[:profit] >= 0 ? 'text-success-600' : 'text-error-600', currency: true, card_color: @yearly_summary[:profit] >= 0 ? 'info' : 'warning' %>
    </div>
  </section>

  <!-- Cash Flow Chart -->
  <%= render 'dashboard/cash_flow_chart' %>

  <!-- Quick Stats -->
  <section class="md:col-span-12">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
      <span class="w-1 h-6 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full"></span>
      Estat√≠sticas R√°pidas
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <%= render 'dashboard/stat_card', icon: 'üë•', title: 'Total de Atletas', value: @total_athletes, card_color: 'primary' %>
      <%= render 'dashboard/stat_card', icon: '‚öΩ', title: 'Total de Jogos', value: @total_matches, card_color: 'secondary' %>
      <%= render 'dashboard/stat_card', icon: '‚è≥', title: 'Pagamentos Pendentes', value: @pending_payments, card_color: 'warning' %>
      <%= render 'dashboard/stat_card', icon: 'üìä', title: 'Pr√≥ximos Jogos', value: @upcoming_matches.count, card_color: 'info' %>
    </div>
  </section>

  <!-- Action Buttons -->
  <section class="md:col-span-12">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
      <span class="w-1 h-6 bg-gradient-to-b from-secondary-500 to-secondary-600 rounded-full"></span>
      A√ß√µes R√°pidas
    </h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
      <%= render 'dashboard/action_button', path: new_athlete_path, icon: 'üë§', text: 'Adicionar Atleta', variant: :primary %>
      <%= render 'dashboard/action_button', path: new_match_path, icon: '‚öΩ', text: 'Agendar Jogo', variant: :primary %>
      <%= render 'dashboard/action_button', path: new_payment_path, icon: 'üí≥', text: 'Registrar Pagamento', variant: :secondary %>
      <%= render 'dashboard/action_button', path: new_expense_path, icon: 'üìù', text: 'Adicionar Despesa', variant: :secondary %>
    </div>
  </section>

  <!-- Recent Activity -->
  <section class="md:col-span-12">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
      <span class="w-1 h-6 bg-gradient-to-b from-info-500 to-info-600 rounded-full"></span>
      Atividade Recente
    </h2>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Recent Payments -->
      <div class="rounded-lg bg-white border border-neutral-200 p-6 shadow-sm hover:shadow-md transition-shadow">
        <h3 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2">
          <span class="w-1 h-5 bg-success-500 rounded-full"></span>
          Pagamentos Recentes
        </h3>
        <% if @recent_payments.any? %>
          <div class="space-y-3">
            <% @recent_payments.each do |payment| %>
              <%= render 'dashboard/recent_payment_item', payment: payment %>
            <% end %>
          </div>
        <% else %>
          <p class="text-sm text-neutral-500 text-center py-4">Nenhum pagamento recente</p>
        <% end %>
      </div>

      <!-- Recent Expenses -->
      <div class="rounded-lg bg-white border border-neutral-200 p-6 shadow-sm hover:shadow-md transition-shadow">
        <h3 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2">
          <span class="w-1 h-5 bg-error-500 rounded-full"></span>
          Despesas Recentes
        </h3>
        <% if @recent_expenses.any? %>
          <div class="space-y-3">
            <% @recent_expenses.each do |expense| %>
              <%= render 'dashboard/recent_expense_item', expense: expense %>
            <% end %>
          </div>
        <% else %>
          <p class="text-sm text-neutral-500 text-center py-4">Nenhuma despesa recente</p>
        <% end %>
      </div>

      <!-- Recent Athletes -->
      <div class="rounded-lg bg-white border border-neutral-200 p-6 shadow-sm hover:shadow-md transition-shadow">
        <h3 class="text-lg font-semibold text-neutral-900 mb-4 flex items-center gap-2">
          <span class="w-1 h-5 bg-primary-500 rounded-full"></span>
          Atletas Recentes
        </h3>
        <% if @recent_athletes.any? %>
          <div class="space-y-3">
            <% @recent_athletes.each do |athlete| %>
              <%= render 'dashboard/recent_athlete_item', athlete: athlete %>
            <% end %>
          </div>
        <% else %>
          <p class="text-sm text-neutral-500 text-center py-4">Nenhum atleta recente</p>
        <% end %>
      </div>
    </div>
  </section>

  <!-- Upcoming Matches -->
  <section class="md:col-span-12">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
      <span class="w-1 h-6 bg-gradient-to-b from-warning-500 to-warning-600 rounded-full"></span>
      Pr√≥ximos Jogos
    </h2>
    <% if @upcoming_matches.any? %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <% @upcoming_matches.each do |match| %>
          <%= render 'dashboard/upcoming_match_card', match: match %>
        <% end %>
      </div>
    <% else %>
      <div class="rounded-lg bg-white border border-neutral-200 p-6 text-center">
        <p class="text-sm text-neutral-500">Nenhum jogo agendado</p>
      </div>
    <% end %>
  </section>

  <!-- Equilibrium Point Analysis -->
  <section class="md:col-span-12">
    <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
      <span class="w-1 h-6 bg-gradient-to-b from-primary-500 to-primary-600 rounded-full"></span>
      An√°lise do Ponto de Equil√≠brio
    </h2>

    <%= render 'dashboard/equilibrium_point_form' %>

    <div id="equilibrium-point-result-container">
      <% if @equilibrium_point.present? %>
        <%= render 'dashboard/equilibrium_point_result' %>
      <% else %>
        <div id="equilibrium-point-result" class="rounded-lg bg-white border border-neutral-200 p-6 shadow-sm">
          <div class="text-center py-8">
            <p class="text-base font-semibold text-neutral-900 mb-2">Nenhuma sele√ß√£o realizada</p>
            <p class="text-sm text-neutral-600">
              Selecione pelo menos um tipo de receita e um tipo de despesa para calcular o ponto de equil√≠brio.
            </p>
          </div>
        </div>
      <% end %>
    </div>
  </section>

  <!-- Debtors Overview -->
  <% if @debtors.present? %>
    <section class="md:col-span-12">
      <h2 class="text-xl font-semibold text-neutral-900 mb-4 flex items-center gap-2">
        <span class="w-1 h-6 bg-gradient-to-b from-error-500 to-error-600 rounded-full"></span>
        Vis√£o Geral de Pagamentos Pendentes
      </h2>
      <div class="rounded-lg bg-white border border-neutral-200 p-4 mb-6">
        <div class="text-center">
          <span class="text-3xl font-bold text-neutral-900"><%= @debtors.count %></span>
          <span class="block text-sm text-neutral-600 mt-1">Atletas com Pagamentos Pendentes</span>
        </div>
      </div>

      <div class="space-y-3">
        <% @debtors.limit(@debtors_display_limit).each do |debtor| %>
          <%= render 'dashboard/debtor_item', debtor: debtor %>
        <% end %>
      </div>

      <% if @debtors.count > @debtors_display_limit %>
        <div class="rounded-lg bg-neutral-50 border border-neutral-200 p-4 mt-4 text-center">
          <p class="text-sm text-neutral-600 mb-2">Mostrando <%= @debtors_display_limit %> de <%= @debtors.count %> atletas com pagamentos pendentes</p>
          <%= link_to "Ver Todos os Devedores", athletes_path, class: button_classes(variant: :secondary, size: :sm) %>
        </div>
      <% end %>
    </section>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const chartTabs = document.querySelectorAll('[data-period]');
    const chartPeriods = document.querySelectorAll('.chart-period');

    // Initialize state - set first button as active
    function initializeChartTabs() {
      chartTabs.forEach((tab, index) => {
        if (index === 0) {
          // First tab (monthly) should be active
          tab.classList.add('active', 'bg-secondary-600', 'text-white');
          tab.classList.remove('bg-neutral-200', 'text-neutral-900');
        } else {
          // Other tabs should be inactive
          tab.classList.remove('active', 'bg-secondary-600', 'text-white');
          tab.classList.add('bg-neutral-200', 'text-neutral-900');
        }
      });
      
      // Set initial chart visibility
      chartPeriods.forEach((period, index) => {
        if (index === 0) {
          period.classList.remove('hidden');
          period.classList.add('active');
        } else {
          period.classList.add('hidden');
          period.classList.remove('active');
        }
      });
    }

    // Initialize on page load
    initializeChartTabs();

    // Handle tab clicks
    chartTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        const period = this.getAttribute('data-period');

        // Reset all tabs to inactive state
        chartTabs.forEach(t => {
          t.classList.remove('active', 'bg-secondary-600', 'text-white');
          t.classList.add('bg-neutral-200', 'text-neutral-900');
        });
        
        // Hide all chart periods
        chartPeriods.forEach(p => {
          p.classList.add('hidden');
          p.classList.remove('active');
        });
        
        // Activate clicked tab
        this.classList.add('active', 'bg-secondary-600', 'text-white');
        this.classList.remove('bg-neutral-200', 'text-neutral-900');
        
        // Show corresponding chart
        const targetChart = document.getElementById(period + '-chart');
        if (targetChart) {
          targetChart.classList.remove('hidden');
          targetChart.classList.add('active');
        }
      });
    });
  });
</script>
